{% extends "base.html"  %}
<!DOCTYPE html>
    <html lang="en">
	<meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Realtime Map</title>
        
		
	</head>
	
	<body>
		{% block content %}
		<div class="main">
			<div class="main_text">
				<h1><b>Real Time Map</b></h1>
				<p>Here you are able to interact with the map to locate our sensors and see real data in real time.</p>
			</div>
			<div style="width: 80%; height: 100%" id="mapContainer">
				<div id="map" style="height: 440px; border: 1px solid #AAA;">Test
					<script>

						//see the link above to see where the variable fileTobeRead comes from.
						const KEY = 'FG6XTNR4E8BLPO6YNTA01B5B';
						const URI = 'https://api.quant-aq.com/device-api/v1/account';
						
						
						async function getData(link) {
							const response = await fetch("https://api.quant-aq.com/device-api/v1/account", {
								method: "GET",
								headers: {
									Authorization: "Basic Rkc2WFROUjRFOEJMUE82WU5UQTAxQjVCOg=="
								},
								mode: "no-cors"
							})
							console.log(response.json());
							// fetch(URI, {
							// 	method: "GET", 
							// 	headers: {'Authorization': 'Basic ' + btoa('FG6XTNR4E8BLPO6YNTA01B5B:')}, 
							// 	mode: "no-cors"
							// })
							// 	.then(response => {if (!response.ok) {
							// 		throw new Error(`HTTP error! Status: ${ response.status }`);
							// 		} 
							// 		else {return response.json()}})
							// 	.then(data => {
							// 		console.log(data);
							// 		return data;
							// 	})
							// 	.catch(error => {
							// 		console.error('Error:', error);
							// 		// return error;
							// 	});
								
						}

						getData(URI);
						// var data = getData(URI);
						// console.log(JSON.stringify(data));

						var lat = 42.361145;
						var long =  -71.057083;
						var map = new L.map('map', {'zoomControl':false}).setView([42.35, -71.08], 13);
						var sensorArray = [];

						// load a tile layer
						L.tileLayer('http://tiles.mapc.org/basemap/{z}/{x}/{y}.png',
							{
							attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
							maxZoom: 17,
							minZoom: 9
							}).addTo(map);

						var circleMarker = L.circleMarker([lat - 0.02, long - .02], {
							color: 'red',
							fillColor: '#f03',
							fillOpacity: 0.5,
							radius: 20
						}).addTo(map);


						// Create button(s) for the marker popup
						btnDiv = document.createElement('div'); // Dom = document object model -- creates div html element
						exploreButton = createButton('Explore Data', btnDiv); // creates btn in container
						reportButton = createButton('View Report', btnDiv); // creates btn in container
						
						// Add HTML content to the div element
						btnDiv.innerHTML = 'Test' + '<br>'; // Inner html concatenates, to add more later use +=
						btnDiv.append(exploreButton);
						btnDiv.append(reportButton);

						circleMarker.bindPopup(btnDiv);

						L.DomEvent.on(exploreButton, 'click', function () {
							window.open(window.location + '/' + 'explore');
							});

						L.DomEvent.on(reportButton, 'click', function () {
							window.open(window.location + '/' + 'reports');
						});

						function createButton(label, container) {
								var btn = L.DomUtil.create('button', '', container);
								btn.setAttribute('type', 'button');
								btn.innerHTML = label;
								return btn;
							}

						function onMapClick(e) {
							var popup = L.popup();
							
							popup
								.setLatLng(e.latlng)
								.setContent('You clicked the map')
								.openOn(map);
						}
						
						function revertUrl(e) {
							alert("reverting");
							window.open(window.location.slice(0, url.lastIndexOf('/')));
						}

						map.on('click', onMapClick);
						map.on('remove', revertUrl);
					</script>
				</div>
			</div>
		</div>
		
		{% endblock %}
	</body>
	
</html>
	

