<!DOCTYPE html>
    <html lang="en">
	<meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Air Partners Website</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/map_styles.css') }}">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
   integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
   crossorigin=""/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@400;700&display=swap" rel="stylesheet">
		 <!-- Make sure you put this AFTER Leaflet's CSS -->
		<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
		integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
		crossorigin=""></script>
		<script src="https://js.api.here.com/v3/3.1/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://js.api.here.com/v3/3.1/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body style="margin: 0">
		<h1><b>Real Time Map</b></h1>
		<div style="width: 100%; height: 100%" id="mapContainer">
			<div id="map" style="height: 440px; border: 1px solid #AAA;">Div
				<script>

					//see the link above to see where the variable fileTobeRead comes from.
					const KEY = 'VSZMMY8VT8FIRNIIXWTD2G7V';
					const URI = 'https://api.quant-aq.com/device-api/';
					
					
					function getData(URI) {
						fetch(URI, {method: "GET", mode: "no-cors"})
							.then(response => {if (!response.ok) {
      							throw new Error(`HTTP error! Status: ${ response.status }`);
    							} 
								else {response.json()}})
							.then(data => {
								console.log(data);
							})
							.catch(error => {
								console.error('Error:', error);
							});
							
					}

					var data = getData(URI);
					console.log(JSON.stringify(data));

					var lat = 42.361145;
					var long =  -71.057083;
					var map = L.map('map').setView([42.35, -71.08], 13);
					var sensorArray = [];

					// load a tile layer
					L.tileLayer('http://tiles.mapc.org/basemap/{z}/{x}/{y}.png',
						{
						attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
						maxZoom: 17,
						minZoom: 9
						}).addTo(map);

					var circleMarker = L.circleMarker([lat - 0.02, long - .02], {
						color: 'red',
						fillColor: '#f03',
						fillOpacity: 0.5,
						radius: 20
					}).addTo(map);


					// Create button(s) for the marker popup
					btnDiv = document.createElement('div'); // Dom = document object model -- creates div html element
					exploreButton = createButton('Explore Data', btnDiv); // creates btn in container
					reportButton = createButton('View Report', btnDiv); // creates btn in container
					
					// Add HTML content to the div element
					btnDiv.innerHTML = 'Test' + '<br>'; // Inner html concatenates, to add more later use +=
					btnDiv.append(exploreButton);
					btnDiv.append(reportButton);

					circleMarker.bindPopup(btnDiv);

					L.DomEvent.on(exploreButton, 'click', function () {
						window.open(window.location + '/' + 'explore');
						});

					L.DomEvent.on(reportButton, 'click', function () {
						window.open(window.location + '/' + 'reports');
					});

					function createButton(label, container) {
							var btn = L.DomUtil.create('button', '', container);
							btn.setAttribute('type', 'button');
							btn.innerHTML = label;
							return btn;
						}

					function onMapClick(e) {
						var popup = L.popup();
						
						popup
							.setLatLng(e.latlng)
							.setContent('You clicked the map')
							.openOn(map);
					}
					
					function revertUrl(e) {
						alert("reverting");
						window.open(window.location.slice(0, url.lastIndexOf('/')));
					}

					map.on('click', onMapClick);
					map.on('remove', revertUrl);
				</script>
			</div>
		</div>
	</body>
</html>
	

